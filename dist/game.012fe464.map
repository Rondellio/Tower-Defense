{"version":3,"sources":["js/CST.js","js/scenes/MenuScene.js","js/scenes/GameScene.js","js/scenes/LoadScene.js","js/game.js"],"names":["CST","SCENES","LOAD","MENU","GAME","MenuScene","key","data","console","log","add","image","setOrigin","setDepth","newGame","game","renderer","width","height","setInteractive","on","scene","start","Phaser","Scene","path","TOWER_GROUP","ENEMY_GROUP","ATTACKS_GROUP","ENEMY_SPEED","ENEMY_HP","ENEMY_SPAWN_RATE","ATTACK_DAMAGE","TOWER_FIRE_RATE","peasantStats","towerId","towerName","upgrade","str","atkRange","atkType","atkRate","hitfly","soldierStats","archerStats","apprenticeStats","knightStats","duelistStats","riflemanStats","rangerStats","wizardStats","sorceressStats","commanderStats","paladinStats","swordmasterStats","cutpurseStats","cannoneerStats","sharpshooterStats","beastmasterStats","assassinStats","firemageStats","icemageStats","lightningmageStats","warlockStats","priestessStats","towerArr","map","buildMap","graphics","drawLines","lineTo","lineStyle","draw","background","sound","volume","loop","nextEnemy","physics","overlap","damageEnemy","input","mouse","disableContextMenu","userAction","pointer","i","Math","floor","y","j","x","leftButtonDown","newTower","get","placeTower","currTower","upgradeTower","rightButtonDown","tower","removeTower","getEnemy","distance","enemyUnits","getChildren","length","active","Distance","Between","enemy","attack","setActive","setVisible","receiveDamage","moveTo","strokePath","addAttack","angle","fire","Enemy","follower","t","vec","Vector2","hp","turned","healthbar","HealthBar","getPoint","setPosition","damage","decrease","play","destroy","death","time","delta","anims","GameObjects","Sprite","Deathknight","call","create","frames","generateFrameNames","prefix","end","frameRate","repeat","Tower","stats","nextTic","hitFly","text","font","fill","upgradeSound","remove","Angle","Peasant","Image","Soldier","bar","Graphics","value","p","existing","amount","clear","fillStyle","fillRect","d","Attack","incX","incY","lifespan","speed","GetSpeed","particles","emitter","createEmitter","scale","quantity","blendMode","startFollow","dx","cos","dy","sin","explode","GameScene","group","classType","eval","runChildUpdate","startOnPath","LoadScene","load","atlas","spritesheet","frameWidth","frameHeight","audio","config","type","AUTO","parent","default","render","pixelArt","Game","preload","name","toLowerCase","update"],"mappings":"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","file":"game.012fe464.map","sourceRoot":"..","sourcesContent":["export const CST = {\r\n    SCENES: {\r\n        LOAD: \"LOAD\",\r\n        MENU: \"MENU\",\r\n        GAME: \"GAME\"\r\n    }\r\n}\r\n","import { CST} from \"../CST\";\r\n\r\nexport class MenuScene extends Phaser.Scene{\r\n    constructor(){\r\n        super({\r\n            key: CST.SCENES.MENU\r\n        })\r\n    }\r\n    init(data){\r\n        console.log(data);\r\n    }\r\n   /* preload(){\r\n        this.load.image('menuscreen', 'assets/bg.png', { frameWidth: 640, frameHeight: 512 });\r\n        this.load.image('newgame', 'assets/new.png');\r\n    }*/\r\n    create(){\r\n        //Creating menu screen background layers\r\n        this.add.image(0, 0, 'menuscreen').setOrigin(0).setDepth(0);\r\n        let newGame = this.add.image(this.game.renderer.width / 2, this.game.renderer.height / 2, 'newgame').setDepth(1);\r\n        console.log(\"In Menu Scene\");\r\n\r\n        newGame.setInteractive();\r\n        newGame.on(\"pointerdown\", ()=>{\r\n            this.scene.start(CST.SCENES.GAME, \"Starting New Game\");\r\n        })\r\n    }\r\n}\r\n","import {CST} from \"../CST\";\r\n//import {Enemy} from \"../Enemy\";\r\n//import {GlobalVariables} from \"../GlobalVariables\";\r\n\r\nvar path;\r\nvar TOWER_GROUP = [];\r\nvar ENEMY_GROUP;\r\nvar ATTACKS_GROUP;\r\n\r\nvar ENEMY_SPEED = 1/10000;\r\n//var ENEMY_SPEED = 1/Math.floor((Math.random() * 10000) + 10000);\r\nvar ENEMY_HP = 1000;\r\nvar ENEMY_SPAWN_RATE = 2000;\r\n//var ENEMY_SPAWN_RATE = Math.floor((Math.random() * 1000) + 1000);\r\nvar ATTACK_DAMAGE = 50;\r\nvar TOWER_FIRE_RATE = 300;\r\n\r\n//stats for each tower type loaded from file rather than defined here, but for now do this\r\n//objects to hold sounds and animation information as well?\r\nvar peasantStats = \t\t {towerId:0,  towerName:\"Peasant\", \t\t upgrade:true,  str:5,  atkRange:\"short\",     atkType:\"physical\", atkRate:\"slow\", \t  hitfly:false};\r\nvar soldierStats = \t\t {towerId:1,  towerName:\"Soldier\", \t\t upgrade:true,  str:10, atkRange:\"short\",     atkType:\"physical\", atkRate:\"medium\",   hitfly:false};\r\nvar archerStats = \t\t {towerId:2,  towerName:\"Archer\", \t\t upgrade:true,  str:8,  atkRange:\"medium\",    atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar apprenticeStats = \t {towerId:3,  towerName:\"Apprentice\", \t upgrade:true,  str:7,  atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"medium\",   hitfly:false};\r\nvar knightStats = \t\t {towerId:4,  towerName:\"Knight\", \t\t upgrade:true,  str:15, atkRange:\"short\",     atkType:\"physical\", atkRate:\"medium\",   hitfly:false};\r\nvar duelistStats = \t\t {towerId:5,  towerName:\"Duelist\", \t\t upgrade:true,  str:12, atkRange:\"short\",     atkType:\"physical\", atkRate:\"fast\", \t  hitfly:false};\r\nvar riflemanStats =\t \t {towerId:6,  towerName:\"Rifleman\", \t upgrade:true,  str:20, atkRange:\"medium\",    atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar rangerStats = \t\t {towerId:7,  towerName:\"Ranger\", \t\t upgrade:true,  str:14, atkRange:\"medium\",    atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar wizardStats = \t\t {towerId:8,  towerName:\"Wizard\", \t\t upgrade:true,  str:10, atkRange:\"medium\", \t  atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar sorceressStats = \t {towerId:9,  towerName:\"Sorceress\", \t upgrade:true,  str:13, atkRange:\"medium\", \t  atkType:\"magical\",  atkRate:\"slow\", \t  hitfly:true};\r\nvar commanderStats = \t {towerId:10, towerName:\"Commander\", \t upgrade:false, str:25, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"slow\", \t  hitfly:false};\r\nvar paladinStats = \t\t {towerId:11, towerName:\"Paladin\", \t\t upgrade:false, str:17, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar swordmasterStats = \t {towerId:12, towerName:\"Swordmaster\", \t upgrade:false, str:14, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"fast\", \t  hitfly:false};\r\nvar cutpurseStats = \t {towerId:13, towerName:\"Cutpurse\", \t upgrade:false, str:6,  atkRange:\"veryshort\", atkType:\"physical\", atkRate:\"veryfast\", hitfly:false};\r\nvar cannoneerStats = \t {towerId:14, towerName:\"Cannoneer\", \t upgrade:false, str:30, atkRange:\"long\", \t  atkType:\"physical\", atkRate:\"veryslow\", hitfly:false};\r\nvar sharpshooterStats =  {towerId:15, towerName:\"Sharpshooter\",  upgrade:false, str:35, atkRange:\"verylong\",  atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar beastmasterStats =   {towerId:16, towerName:\"Beastmaster\", \t upgrade:false, str:20, atkRange:\"long\",      atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar assassinStats = \t {towerId:17, towerName:\"Assassin\", \t upgrade:false, str:18, atkRange:\"long\",      atkType:\"physical\", atkRate:\"fast\", \t  hitfly:true};\r\nvar firemageStats = \t {towerId:18, towerName:\"FireMage\", \t upgrade:false, str:20, atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"fast\", \t  hitfly:true};\r\nvar icemageStats = \t\t {towerId:19, towerName:\"IceMage\", \t\t upgrade:false, str:10, atkRange:\"long\",      atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar lightningmageStats = {towerId:20, towerName:\"LightningMage\", upgrade:false, str:22, atkRange:\"short\",     atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar warlockStats = \t\t {towerId:21, towerName:\"Warlock\", \t\t upgrade:false, str:15, atkRange:\"long\",      atkType:\"magical\",  atkRate:\"slow\", \t  hitfly:true};\r\nvar priestessStats =     {towerId:22, towerName:\"Priestess\", \t upgrade:false, str:13, atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\n\r\nvar towerArr = [peasantStats, \r\n\t\t\tsoldierStats, \r\n\t\t\tarcherStats, \r\n\t\t\tapprenticeStats, \r\n\t\t\tknightStats, \r\n\t\t\tduelistStats, \r\n\t\t\triflemanStats, \r\n\t\t\trangerStats,\r\n\t\t\twizardStats,\r\n\t\t\tsorceressStats,\r\n\t\t\tcommanderStats,\r\n\t\t\tpaladinStats,\r\n\t\t\tswordmasterStats,\r\n\t\t\tcutpurseStats,\r\n\t\t\tcannoneerStats,\r\n\t\t\tsharpshooterStats,\r\n\t\t\tbeastmasterStats,\r\n\t\t\tassassinStats,\r\n\t\t\tfiremageStats,\r\n\t\t\ticemageStats,\r\n\t\t\tlightningmageStats,\r\n\t\t\twarlockStats,\r\n\t\t\tpriestessStats];\r\n\r\n//map for tower placement, 0=can place, -1=cannot place, towerObj=tower already occupying space\r\nvar map =  [[ 0,-1, 0,-1,-1,-1,-1,-1,-1,-1],\r\n            [ 0,-1, 0, 0, 0, 0, 0, 0, 0,-1],\r\n            [ 0,-1,-1,-1,-1,-1,-1,-1, 0,-1],\r\n            [ 0, 0, 0, 0, 0, 0, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1]];\r\n\t\t\t\r\n\r\n//------------------------------------------FUNCTIONS---------------------------------------------------\t\t\t\r\n//build the pathing and map for level\r\nfunction buildMap(scene){\r\n\t//path to which enemey follows\r\n    var graphics = scene.add.graphics();    \r\n    drawLines(graphics);\r\n    path = scene.add.path(96, -32);\r\n    path.lineTo(96, 164);\r\n    path.lineTo(480, 164);\r\n    path.lineTo(480, 544);\r\n    graphics.lineStyle(0, 0xffffff, 1);\r\n    path.draw(graphics);\r\n    \r\n\t//add map image\r\n\tscene.add.image(320, 256, 'map');\r\n\r\n\t//add background music\r\n\tvar background = scene.sound.add('background');\r\n\tbackground.volume = 0.04;\r\n\tbackground.loop = true;\r\n\t//background.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\r\n\tscene.nextEnemy = 0;\r\n\tscene.physics.add.overlap(ENEMY_GROUP, ATTACKS_GROUP, damageEnemy);\r\n    scene.input.mouse.disableContextMenu();\r\n}\r\n\r\n//user input related actions \r\nfunction userAction(pointer, scene){\r\n\tvar i = Math.floor(pointer.y/64);\r\n\tvar j = Math.floor(pointer.x/64);\r\n\tif (pointer.leftButtonDown())\r\n        {\r\n\t\t\t//if new tower\r\n\t\t\tif(map[i][j] == 0)\r\n\t\t\t{\r\n\t\t\t\tvar newTower = TOWER_GROUP[peasantStats.towerId].get(peasantStats);\r\n\t\t\t\tnewTower.placeTower(pointer,scene);\r\n\t\t\t}\r\n\t\t\t//if upgrade tower\r\n\t\t\telse if(typeof map[i][j] === \"object\")\r\n\t\t\t{\r\n\t\t\t\tvar currTower = map[i][j];\r\n\t\t\t\tvar newTower = TOWER_GROUP[soldierStats.towerId].get(soldierStats);\r\n\t\t\t\tcurrTower.upgradeTower(pointer, newTower, scene);\r\n\t\t\t}\r\n        }\r\n        else if (pointer.rightButtonDown())\r\n        {\r\n\t\t\tvar tower = map[i][j];\r\n\t\t\tif(typeof tower === \"object\")\r\n\t\t\t{\r\n\t\t\t\ttower.removeTower(pointer);\r\n\t\t\t}\r\n\r\n        }\r\n}\r\n\r\nfunction getEnemy(x, y, distance) {\r\n    var enemyUnits = ENEMY_GROUP.getChildren();\r\n    for(var i = 0; i < enemyUnits.length; i++) {       \r\n        if(enemyUnits[i].active && Phaser.Math.Distance.Between(x, y, enemyUnits[i].x, enemyUnits[i].y) < distance)\r\n            return enemyUnits[i];\r\n    }\r\n    return false;\r\n} \r\n\r\nfunction damageEnemy(enemy, attack) {  \r\n    // only if both enemy and attack are alive\r\n    if (enemy.active === true && attack.active === true) {\r\n        // we remove the attack right away\r\n        attack.setActive(false);\r\n        attack.setVisible(false);    \r\n        \r\n        // decrease the enemy hp with ATTACK_DAMAGE\r\n        enemy.receiveDamage(ATTACK_DAMAGE);\r\n        //damage.play();\r\n    }\r\n}\r\n\r\nfunction drawLines(graphics) {\r\n    graphics.lineStyle(1, 0x0000ff, 0.8);\r\n    for(var i = 0; i < 8; i++) {\r\n        graphics.moveTo(0, i * 64);\r\n        graphics.lineTo(640, i * 64);\r\n    }\r\n    for(var j = 0; j < 10; j++) {\r\n        graphics.moveTo(j * 64, 0);\r\n        graphics.lineTo(j * 64, 512);\r\n    }\r\n    graphics.strokePath();\r\n}\t\r\n\r\nfunction addAttack(x, y, angle) {\r\n    var attack = ATTACKS_GROUP.get();\r\n    if (attack)\r\n    {\r\n        attack.fire(x, y, angle);\r\n    }\r\n}\r\n//---------------------------------------------------------CLASSES--------------------------------------------\r\n//enemy class\r\nclass Enemy extends Phaser.GameObjects.Sprite {\r\n\r\n    constructor (scene)\r\n    {\r\n        super(scene);\r\n        //dknight.animations.add('walk_down', 1, 4);\r\n        //this.anims.create({ key: 'down', frames: this.anims.generateFrameNames('deathknight', { prefix: 'walk_down_', start: 1, end: 4 }), frameRate: 5, repeat: -1 })\r\n\t\t//var enemy = Phaser.GameObjects.Sprite.call(this, scene, 0, 0, 'deathknight');\r\n\r\n        this.follower = { t: 0, vec: new Phaser.Math.Vector2() };\r\n        this.hp = 0;\r\n        this.turned = 0;\r\n\t\t\r\n\t\t//this.text = scene.add.text(0, 0, \"HP: \"+ ENEMY_HP, {font: \"16px Arial\", fill: \"#ffffff\"});\r\n\t\t//this.text.setPadding(0, 0, 0, 60);\r\n\t\t//this.text.setOrigin(0.5);\r\n\t\tthis.healthbar = new HealthBar(scene, 0, 0);\r\n\t\t\r\n    }\r\n\r\n\tstartOnPath ()\r\n\t{\r\n\t\tthis.follower.t = 0;\r\n\t\tthis.hp = ENEMY_HP;\r\n\t\t\r\n\t\t//this.walk.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\r\n\t\tpath.getPoint(this.follower.t, this.follower.vec);\r\n\t\t\r\n\t\tthis.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\t\r\n\t\t//this.text.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\tthis.healthbar.setPosition(this.follower.vec.x - this.width, this.follower.vec.y - this.height);\r\n\t }\r\n\t\r\n\treceiveDamage(damage) {\r\n\t\tthis.hp -= damage;           \r\n\t\t//this.text.setText(\"HP: \" + this.hp);\r\n\t\tthis.healthbar.decrease(damage);\r\n\t\tthis.damage.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\r\n\t\t// if hp drops below 0 we deactivate this enemy\r\n\t\tif (this.hp <= 0) {\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\t//this.text.setActive(false);\r\n\t\t\t//this.text.setVisible(false);\r\n\t\t\tthis.healthbar.destroy();\r\n\t\t\t\r\n\t\t\t//Need to set this to stop when all enemies are dead\r\n\t\t\tthis.death.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\t//this.walk.stop();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdate (time, delta)\r\n\t{\r\n\t\t//ENEMY_SPEED = 1/Math.floor((Math.random() * (10000 - 5000)) + 5000);\r\n\t\tthis.follower.t += ENEMY_SPEED * delta;\r\n\t\t\r\n\t\tpath.getPoint(this.follower.t, this.follower.vec);\r\n\t\t\r\n\t\tthis.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\t//this.text.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\tthis.healthbar.setPosition(this.follower.vec.x - this.width, this.follower.vec.y - this.height);\r\n\t\t\r\n\t\tif (this.follower.vec.y == 164 && this.turned == 0) {\r\n\t\t\tthis.anims.play('dkright');\r\n\t\t\tthis.turned = 1;\r\n\t\t}\r\n\t\telse if (this.follower.vec.y != 164 && this.turned == 1)\r\n\t\t{\r\n\t\t\tthis.anims.play('dkdown');\r\n\t\t\tthis.turned = 2;\r\n\t\t}\r\n\r\n\t\tif (this.follower.t >= 1)\r\n\t\t{\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\t//this.text.setActive(false);\r\n\t\t\t//this.text.setVisible(false);\r\n\t\t\tthis.healthbar.destroy();\r\n\t\t\t//this.walk.stop();\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nclass Deathknight extends Enemy {\r\n\tconstructor(scene) {\r\n\t\tsuper(scene);\r\n\t\tPhaser.GameObjects.Sprite.call(this, scene, 0, 0, 'deathknight');\r\n\t\t\r\n\t\t//create animations\r\n\t\tscene.anims.create({\r\n\t\t\tkey: 'dkdown',\r\n\t\t\tframes: scene.anims.generateFrameNames('deathknight', { prefix: 'walk_down_', start: 1, end: 4 }),\r\n\t\t\tframeRate: 3,\r\n\t\t\trepeat: -1\r\n\t\t});\r\n\t\tscene.anims.create({\r\n\t\t\tkey: 'dkright',\r\n\t\t\tframes: scene.anims.generateFrameNames('deathknight', { prefix: 'walk_right_', start: 1, end: 4 }),\r\n\t\t\tframeRate: 5,\r\n\t\t\trepeat: -1\r\n\t\t});\r\n        this.anims.play('dkdown');\r\n\t\t\r\n\t\t//create sounds\r\n\t\tthis.death = scene.sound.add('dkDeath');\r\n\t\tthis.death.volume = 0.05;\r\n\t\tthis.death.loop = false;\r\n\t\t\r\n\t\tthis.damage = scene.sound.add('hit');\r\n\t\tthis.damage.volume = 0.03;\r\n\t\tthis.damage.loop = false;\r\n\t\t\r\n\t\t/* this.walk = scene.sound.add('walk');\r\n\t\tthis.walk.volume = 0.01;\r\n\t\tthis.walk.loop = true; */\r\n\t}\r\n\tpFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\n//tower class\r\nclass Tower extends Phaser.GameObjects.Sprite{\r\n\r\n\tconstructor (scene, stats)\r\n\t{\r\n\t\tsuper(scene);\r\n\r\n\t\tthis.nextTic = 0;\r\n\t\tthis.towerId =  stats.towerId; //each tower has unique id\r\n\t\tthis.towerName = stats.towerName;\r\n\t\tthis.upgrade = stats.upgrade; //true = can upgrade, false = can't upgrade\r\n\t\tthis.str = stats.str; //value tha determines attack strength\r\n\t\tthis.atkRange = stats.atkRange;\r\n\t\tthis.atkType = stats.atkType;\r\n\t\tthis.atkRate = stats.atkRate; \r\n\t\tthis.hitFly = stats.hitFly; //true = can hit flying enemeies, false = cannot hit flying enemies\r\n\t\t//this.aoeRange = aoeRange; //area of effect range\r\n\t\t//this.spc = spc; //has special attack, each value represents special type, 0 = none, 1 = chance to stun, etc.\r\n\t\t\r\n\t\tthis.text = scene.add.text(0, 0, this.towerName, {font: \"16px Arial\", fill: \"#ffffff\"});\r\n\t\t\r\n\t\tthis.upgradeSound = scene.sound.add('upgradeSound');\r\n\t\tthis.upgradeSound.volume = 0.05;\r\n\t\tthis.upgradeSound.loop = false;\r\n\t\t\r\n\t}\r\n\t\r\n\tplaceTower(pointer,scene) {\r\n\t\tvar i = Math.floor(pointer.y/64);\r\n\t\tvar j = Math.floor(pointer.x/64);\r\n\t\tif(map[i][j] === 0) {\r\n\t\t\t//console.log(tower);\r\n\t\t\tif (this)\r\n\t\t\t{\r\n\t\t\t\tthis.text.y = (i+.50) * 64 + 64/2;\r\n\t\t\t\tthis.text.x = j * 64 + 64/2;\r\n\t\t\t\tthis.text.setOrigin(0.5);\r\n\t\t\t\t//scene.add.container([this.text, this]);\r\n\t\t\t\tthis.setActive(true);\r\n\t\t\t\tthis.setVisible(true);\r\n\t\t\t\tthis.y = i * 64 + 64/2;\r\n\t\t\t\tthis.x = j * 64 + 64/2;\r\n\t\t\t\t//map[i][j] = 1;\r\n\t\t\t\tmap[i][j] = this;\r\n\t\t\t}   \r\n\t\t\t//console.log(TOWER_GROUP.getTotalUsed());\r\n\t\t\t//console.log(TOWER_GROUP.getLength());\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tTOWER_GROUP[this.towerId].remove(this, true, true);\t\t//tower is created before it's placed so removed if the place clicked on is  not avaialble\r\n\t\t}\r\n\t}\r\n\r\n\tremoveTower(pointer) {\r\n\t\tvar i = Math.floor(pointer.y/64);\r\n\t\tvar j = Math.floor(pointer.x/64);\r\n\t\tif(map[i][j] !== 0) {\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\tthis.text.destroy();\r\n\t\t\tmap[i][j] = 0;\t\t\t\t\t\t\t\t\t\t\t\t//remove from map\r\n\t\t\tTOWER_GROUP[this.towerId].remove(this, true, true);\t\t\t//removes from group, if want to keep it as inactive then remove this line\r\n\t\t}\r\n\t\t\t\r\n\t}\r\n\t\r\n\tupgradeTower(pointer, newTower, scene) {\r\n\t\t//check if tower is already upgraded, if not the upgrade\r\n\t\tif(this.towerName !== newTower.towerName)\r\n\t\t{\r\n\t\t\tvar i = Math.floor(pointer.y/64);\r\n\t\t\tvar j = Math.floor(pointer.x/64);\r\n\t\t\tthis.removeTower(pointer);\r\n\t\t\tnewTower.placeTower(pointer, scene);\r\n\t\t\t//console.log(TOWER_GROUP.getTotalUsed());\r\n\t\t\t//console.log(TOWER_GROUP.getLength());\r\n\t\t\tthis.text = newTower.towerName;\r\n\t\t\tthis.upgradeSound.play();\r\n\r\n            /* scene.tweens.add({\r\n                targets: newTower, // on the player \r\n                duration: 200, // for 200ms \r\n                scaleX: 1.2, // that scale vertically by 20% \r\n                scaleY: 1.2, // and scale horizontally by 20% \r\n                alpha: 0.2,\r\n                yoyo: true, // at the end, go back to original scale \r\n            }); */\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tTOWER_GROUP[newTower.towerId].remove(newTower, true, true);\t\t//tower is created before it's placed so removed if the place clicked on is  not avaialble\r\n\t\t\tnewTower.text.destroy();\r\n\t\t}\r\n\t\r\n\t}\r\n\t\r\n\tfire() {\r\n\t\tvar enemy = getEnemy(this.x, this.y, 200);\r\n\t\tif(enemy) {\r\n\t\t\tvar angle = Phaser.Math.Angle.Between(this.x, this.y, enemy.x, enemy.y);\r\n\t\t\taddAttack(this.x, this.y, angle);\r\n\t\t\t//this.angle = (angle + Math.PI/2) * Phaser.Math.RAD_TO_DEG;    //uncomment to make towers rotate to face enemy\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdate(time, delta, pointer)\r\n\t{\r\n\t\tif(time > this.nextTic) {\r\n\t\t\tthis.fire();\r\n\t\t\tthis.nextTic = time + TOWER_FIRE_RATE;\r\n\t\t}\r\n\t}\r\n\tsayName()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n};\r\n\r\nclass Peasant extends Tower {\r\n\tconstructor(scene, stats) {\r\n\t\t// Note: In derived classes, super() must be called before you\r\n\t\t// can use 'this'. Leaving this out will cause a reference error.\r\n\t\tsuper(scene, stats);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'peasant', 'sprite35');\r\n\t}\r\n\tpFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\nclass Soldier extends Tower {\r\n\tconstructor(scene, stats) {\r\n\t\tsuper(scene, stats);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'soldier', 'sprite25');\r\n\r\n\t}\r\n\tsFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\n//all other classes\r\n//HP class\r\nclass HealthBar {\r\n\r\n    constructor(scene, x, y) {\r\n        this.bar = new Phaser.GameObjects.Graphics(scene);\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n        this.value = ENEMY_HP;\r\n        this.p = .076;\r\n\r\n        this.draw();\r\n\r\n        scene.add.existing(this.bar);\r\n    }\r\n\r\n    setPosition(x, y) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.draw();\r\n    }\r\n\r\n    decrease(amount) {\r\n        this.value -= amount;\r\n\r\n        if (this.value < 0) {\r\n            this.value = 0;\r\n        }\r\n\r\n        this.draw();\r\n\r\n        return (this.value === 0);\r\n    }\r\n\r\n    draw() {\r\n        this.bar.clear();\r\n\r\n        //  BG\r\n        this.bar.fillStyle(0x000000);\r\n        this.bar.fillRect(this.x, this.y, 80, 16);\r\n\r\n        //  Health\r\n\r\n        this.bar.fillStyle(0xffffff);\r\n        this.bar.fillRect(this.x + 2, this.y + 2, 76, 12);\r\n\r\n        if (this.value < 0.6 * ENEMY_HP) {\r\n            this.bar.fillStyle(0xff0000);\r\n        }\r\n        else if (this.value < 0.3 * ENEMY_HP)\r\n            this.bar.fillStyle(0x00ffff);\r\n        else {\r\n            this.bar.fillStyle(0x00ff00);\r\n        }\r\n\r\n        var d = Math.floor(this.p * this.value);\r\n\r\n        this.bar.fillRect(this.x + 2, this.y + 2, d, 12);\r\n    }\r\n\r\n    destroy() {\r\n        this.bar.destroy();\r\n    }\r\n\r\n}\r\n\r\n//the yellow thing the towers shoots at enemy, can be any form of projectile\r\nclass Attack extends Phaser.GameObjects.Image {\r\n\tconstructor(scene)\r\n\t{\r\n\t\tsuper(scene);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'attack');\r\n\r\n\t\tthis.incX = 0;\r\n\t\tthis.incY = 0;\r\n\t\tthis.lifespan = 0;\r\n\r\n\t\tthis.speed = Phaser.Math.GetSpeed(600, 1);\r\n\r\n    \tthis.particles = scene.add.particles('attack');\r\n\r\n        this.emitter = this.particles.createEmitter({\r\n            speed: 75,\r\n            scale: { start: 0.2, end: 0 },\r\n            quantity: 1,\r\n            blendMode: 'SCREEN'\r\n        });\r\n\r\n\t    this.emitter.startFollow(this);\r\n        \r\n\t}\r\n\r\n\tfire(x, y, angle)\r\n\t{\r\n\t\tthis.setActive(true);\r\n\t\tthis.setVisible(true);\r\n\t\t//  Attacks fire from the middle of the screen to the given x/y\r\n\t\tthis.setPosition(x, y);\r\n\t\t\r\n\t//  we don't need to rotate the attacks as they are round\r\n\t//    this.setRotation(angle);\r\n\r\n\t\tthis.dx = Math.cos(angle);\r\n\t\tthis.dy = Math.sin(angle);\r\n\r\n\t\tthis.lifespan = 1000;\r\n\t}\r\n\r\n\tupdate (time, delta)\r\n\t{\r\n\t\tthis.lifespan -= delta;\r\n\t\tthis.x += this.dx * (this.speed * delta);\r\n\t\tthis.y += this.dy * (this.speed * delta);\r\n        this.emitter.explode(5,this.x,this.y);\r\n\r\n\t\tif (this.lifespan <= 0)\r\n\t\t{\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n            \r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\n\r\nexport class GameScene extends Phaser.Scene {\r\n    constructor(){\r\n        super({\r\n            key: CST.SCENES.GAME\r\n        })\r\n    }\r\n\r\n    \r\n    //Preload function loads assets before game starts\r\n \r\n    init(data){\r\n        console.log(data);\r\n    }\r\n\r\n    //create function initializes and adds assets to game\r\n    create() {\r\n        /*creates a group for a tower type, that way we can use TOWER_GROUP.get(towerStats) to instantiate new towers easily\r\n\tloop through towerArr to get each tower object\r\n\tthen add each object to TOWER_GROUP arr\r\n\twe do this becuase TOWER_GROUP can now be easily used to manipulate tower objects with Phaser functions.*/\r\n\t//loop set to 2 since we only have 2 developed classes at the moment\r\n\tfor(var i = 0; i < 2; i++) {\r\n\t\tTOWER_GROUP[towerArr[i].towerId] = this.add.group({ classType: eval(towerArr[i].towerName), runChildUpdate: true });\r\n\t}\r\n\t\r\n\t//enemy group will be a loop similar to tower group\r\n\tENEMY_GROUP = this.physics.add.group({ classType: Deathknight, runChildUpdate: true }); //key: 'walk_down_', frame: [1, 2, 3, 4], repeat: 5, active: true });\r\n\t\r\n\t//turned into attack group soon for different attack types\r\n\tATTACKS_GROUP = this.physics.add.group({ classType: Attack, runChildUpdate: true });\r\n\t\r\n\t//build the game map, this includes pathing, map image, background sounds, and general game assets\r\n\tbuildMap(this);\r\n\t\r\n\t//input related actions in userAction function\r\n\tthis.input.on('pointerdown', function (pointer){userAction(pointer, this)});\r\n\r\n\t/*let nextScene = this.add.text(this.game.renderer.width / 2, this.game.renderer.height / 2, 'nextScene').setDepth(1);\r\n\tnextScene.setInteractive();\r\n\tnextScene.on(\"pointerdown\", ()=>{\r\n\t\tthis.scene.start(CST.SCENES.GAME2, \"Armory Level\");\r\n\t})*/\r\n    }\r\n\r\n    //update function constantly refreshes so to progress game\r\n    update(time, delta, path) {  \r\n\r\n        if (time > this.nextEnemy)\r\n        {\r\n            var enemy = ENEMY_GROUP.get(path);\r\n            if (enemy)\r\n            {\r\n                enemy.setActive(true);\r\n                enemy.setVisible(true);\r\n                enemy.startOnPath();\r\n                //ENEMY_SPEED = 1/Math.floor((Math.random() * (2000 - 500)) + 500);\r\n                this.nextEnemy = time + ENEMY_SPAWN_RATE;\r\n            }       \r\n        }\r\n\t\r\n    }\r\n}\r\n","import { CST} from \"../CST\";\r\n\r\nexport class LoadScene extends Phaser.Scene{\r\n    constructor(){\r\n        super({\r\n            key: CST.SCENES.LOAD\r\n        })\r\n    }\r\n\r\n    preload(){\r\n        this.load.atlas('deathknight', './assets/deathknight.png', 'assets/deathknight.json');\r\n        this.load.atlas('goldenarmor', './assets/goldenarmor.png', 'assets/goldenarmor.json');\r\n        this.load.atlas('peasant', './assets/peasant.png', 'assets/peasant.json');\r\n        this.load.spritesheet('bard', './assets/bard.png', { frameWidth: 52, frameHeight: 75});\r\n        this.load.image('attack', './assets/coin.png');\r\n        this.load.image('map', './assets/castle-gates.png', { frameWidth: 640, frameHeight: 512 });\r\n        this.load.audio('dkDeath', './assets/Sounds/Death Screams/Human/sfx_deathscream_human5.wav');\r\n        this.load.audio('hit', './assets/Sounds/General Sounds/Simple Damage Sounds/sfx_damage_hit2.wav');\r\n        this.load.audio('walk', './assets/Sounds/Movement/Footsteps/sfx_movement_footstepsloop4_slow.wav');\r\n        this.load.audio('background', './assets/Sounds/random silly chip song.ogg');\r\n\r\n        this.load.image('menuscreen', './assets/bg.png', { frameWidth: 640, frameHeight: 512 });\r\n        this.load.image('newgame', './assets/new.png');\r\n    }\r\n    create(){\r\n        //Creating menu screen background layers\r\n        this.scene.start(CST.SCENES.MENU, \"Loading complete\");\r\n        }\r\n}","import {MenuScene} from \"./scenes/MenuScene\";\r\nimport {GameScene} from \"./scenes/GameScene\";\r\nimport {LoadScene} from \"./scenes/LoadScene\";\r\n\r\n//-------------------------------------------------------SETUP-----------------------------------------------------\r\n//master config for game\r\n\r\nvar config = {\r\n    type: Phaser.AUTO,\r\n    parent: 'content',\r\n    width: 640,\r\n    height: 512,\r\n    physics: {\r\n        default: 'arcade'\r\n    },\r\n    render:{\r\n        pixelArt: true\r\n    },\r\n    scene: [\r\n        LoadScene,\r\n        MenuScene,\r\n        GameScene]\r\n\r\n};\r\n\r\n//begin game\r\nvar game = new Phaser.Game(config);\r\n\r\n\r\n\r\n//----------------------------------------------------GAME-------------------------------------------\t\r\n\r\n    //mainGame = this;\r\n\r\n\r\nvar path;\r\nvar TOWER_GROUP = [];\r\nvar ENEMY_GROUP;\r\nvar ATTACKS_GROUP;\r\n\r\nvar ENEMY_SPEED = 1/10000;\r\n//var ENEMY_SPEED = 1/Math.floor((Math.random() * 10000) + 10000);\r\nvar ENEMY_HP = 1000;\r\nvar ENEMY_SPAWN_RATE = 2000;\r\n//var ENEMY_SPAWN_RATE = Math.floor((Math.random() * 1000) + 1000);\r\nvar ATTACK_DAMAGE = 50;\r\nvar TOWER_FIRE_RATE = 300;\r\n\r\n//stats for each tower type loaded from file rather than defined here, but for now do this\r\n//objects to hold sounds and animation information as well?\r\nvar peasantStats = \t\t {towerId:0,  towerName:\"Peasant\", \t\t upgrade:true,  str:5,  atkRange:\"short\",     atkType:\"physical\", atkRate:\"slow\", \t  hitfly:false};\r\nvar soldierStats = \t\t {towerId:1,  towerName:\"Soldier\", \t\t upgrade:true,  str:10, atkRange:\"short\",     atkType:\"physical\", atkRate:\"medium\",   hitfly:false};\r\nvar archerStats = \t\t {towerId:2,  towerName:\"Archer\", \t\t upgrade:true,  str:8,  atkRange:\"medium\",    atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar apprenticeStats = \t {towerId:3,  towerName:\"Apprentice\", \t upgrade:true,  str:7,  atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"medium\",   hitfly:false};\r\nvar knightStats = \t\t {towerId:4,  towerName:\"Knight\", \t\t upgrade:true,  str:15, atkRange:\"short\",     atkType:\"physical\", atkRate:\"medium\",   hitfly:false};\r\nvar duelistStats = \t\t {towerId:5,  towerName:\"Duelist\", \t\t upgrade:true,  str:12, atkRange:\"short\",     atkType:\"physical\", atkRate:\"fast\", \t  hitfly:false};\r\nvar riflemanStats =\t \t {towerId:6,  towerName:\"Rifleman\", \t upgrade:true,  str:20, atkRange:\"medium\",    atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar rangerStats = \t\t {towerId:7,  towerName:\"Ranger\", \t\t upgrade:true,  str:14, atkRange:\"medium\",    atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar wizardStats = \t\t {towerId:8,  towerName:\"Wizard\", \t\t upgrade:true,  str:10, atkRange:\"medium\", \t  atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar sorceressStats = \t {towerId:9,  towerName:\"Sorceress\", \t upgrade:true,  str:13, atkRange:\"medium\", \t  atkType:\"magical\",  atkRate:\"slow\", \t  hitfly:true};\r\nvar commanderStats = \t {towerId:10, towerName:\"Commander\", \t upgrade:false, str:25, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"slow\", \t  hitfly:false};\r\nvar paladinStats = \t\t {towerId:11, towerName:\"Paladin\", \t\t upgrade:false, str:17, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar swordmasterStats = \t {towerId:12, towerName:\"Swordmaster\", \t upgrade:false, str:14, atkRange:\"short\", \t  atkType:\"physical\", atkRate:\"fast\", \t  hitfly:false};\r\nvar cutpurseStats = \t {towerId:13, towerName:\"Cutpurse\", \t upgrade:false, str:6,  atkRange:\"veryshort\", atkType:\"physical\", atkRate:\"veryfast\", hitfly:false};\r\nvar cannoneerStats = \t {towerId:14, towerName:\"Cannoneer\", \t upgrade:false, str:30, atkRange:\"long\", \t  atkType:\"physical\", atkRate:\"veryslow\", hitfly:false};\r\nvar sharpshooterStats =  {towerId:15, towerName:\"Sharpshooter\",  upgrade:false, str:35, atkRange:\"verylong\",  atkType:\"physical\", atkRate:\"slow\", \t  hitfly:true};\r\nvar beastmasterStats =   {towerId:16, towerName:\"Beastmaster\", \t upgrade:false, str:20, atkRange:\"long\",      atkType:\"physical\", atkRate:\"medium\",   hitfly:true};\r\nvar assassinStats = \t {towerId:17, towerName:\"Assassin\", \t upgrade:false, str:18, atkRange:\"long\",      atkType:\"physical\", atkRate:\"fast\", \t  hitfly:true};\r\nvar firemageStats = \t {towerId:18, towerName:\"FireMage\", \t upgrade:false, str:20, atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"fast\", \t  hitfly:true};\r\nvar icemageStats = \t\t {towerId:19, towerName:\"IceMage\", \t\t upgrade:false, str:10, atkRange:\"long\",      atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar lightningmageStats = {towerId:20, towerName:\"LightningMage\", upgrade:false, str:22, atkRange:\"short\",     atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\nvar warlockStats = \t\t {towerId:21, towerName:\"Warlock\", \t\t upgrade:false, str:15, atkRange:\"long\",      atkType:\"magical\",  atkRate:\"slow\", \t  hitfly:true};\r\nvar priestessStats =     {towerId:22, towerName:\"Priestess\", \t upgrade:false, str:13, atkRange:\"medium\",    atkType:\"magical\",  atkRate:\"medium\",   hitfly:true};\r\n\r\nvar towerArr = [peasantStats, \r\n\t\t\tsoldierStats, \r\n\t\t\tarcherStats, \r\n\t\t\tapprenticeStats, \r\n\t\t\tknightStats, \r\n\t\t\tduelistStats, \r\n\t\t\triflemanStats, \r\n\t\t\trangerStats,\r\n\t\t\twizardStats,\r\n\t\t\tsorceressStats,\r\n\t\t\tcommanderStats,\r\n\t\t\tpaladinStats,\r\n\t\t\tswordmasterStats,\r\n\t\t\tcutpurseStats,\r\n\t\t\tcannoneerStats,\r\n\t\t\tsharpshooterStats,\r\n\t\t\tbeastmasterStats,\r\n\t\t\tassassinStats,\r\n\t\t\tfiremageStats,\r\n\t\t\ticemageStats,\r\n\t\t\tlightningmageStats,\r\n\t\t\twarlockStats,\r\n\t\t\tpriestessStats];\r\n\r\n//map for tower placement, 0=can place, -1=cannot place, towerObj=tower already occupying space\r\nvar map =  [[ 0,-1, 0,-1,-1,-1,-1,-1,-1,-1],\r\n            [ 0,-1, 0, 0, 0, 0, 0, 0, 0,-1],\r\n            [ 0,-1,-1,-1,-1,-1,-1,-1, 0,-1],\r\n            [ 0, 0, 0, 0, 0, 0, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1],\r\n            [-1,-1,-1,-1,-1,-1, 0,-1, 0,-1]];\r\n\t\t\t\r\n\r\n//------------------------------------------FUNCTIONS---------------------------------------------------\t\t\t\r\n//build the pathing and map for level\r\nfunction buildMap(scene){\r\n\t//path to which enemey follows\r\n    var graphics = scene.add.graphics();    \r\n    drawLines(graphics);\r\n    path = scene.add.path(96, -32);\r\n    path.lineTo(96, 164);\r\n    path.lineTo(480, 164);\r\n    path.lineTo(480, 544);\r\n    graphics.lineStyle(0, 0xffffff, 1);\r\n    path.draw(graphics);\r\n    \r\n\t//add map image\r\n\tscene.add.image(320, 256, 'map');\r\n\r\n\t//add background music\r\n\tvar background = scene.sound.add('background');\r\n\tbackground.volume = 0.04;\r\n\tbackground.loop = true;\r\n\t//background.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\r\n\tscene.nextEnemy = 0;\r\n\tscene.physics.add.overlap(ENEMY_GROUP, ATTACKS_GROUP, damageEnemy);\r\n    scene.input.mouse.disableContextMenu();\r\n}\r\n\r\n//user input related actions \r\nfunction userAction(pointer, scene){\r\n\tvar i = Math.floor(pointer.y/64);\r\n\tvar j = Math.floor(pointer.x/64);\r\n\tif (pointer.leftButtonDown())\r\n        {\r\n\t\t\t//if new tower\r\n\t\t\tif(map[i][j] == 0)\r\n\t\t\t{\r\n\t\t\t\tvar newTower = TOWER_GROUP[peasantStats.towerId].get(peasantStats);\r\n\t\t\t\tnewTower.placeTower(pointer,scene);\r\n\t\t\t}\r\n\t\t\t//if upgrade tower\r\n\t\t\telse if(typeof map[i][j] === \"object\")\r\n\t\t\t{\r\n\t\t\t\tvar currTower = map[i][j];\r\n\t\t\t\tvar newTower = TOWER_GROUP[soldierStats.towerId].get(soldierStats);\r\n\t\t\t\tcurrTower.upgradeTower(pointer, newTower, scene);\r\n\t\t\t}\r\n        }\r\n        else if (pointer.rightButtonDown())\r\n        {\r\n\t\t\tvar tower = map[i][j];\r\n\t\t\tif(typeof tower === \"object\")\r\n\t\t\t{\r\n\t\t\t\ttower.removeTower(pointer);\r\n\t\t\t}\r\n\r\n        }\r\n}\r\n\r\nfunction getEnemy(x, y, distance) {\r\n    var enemyUnits = ENEMY_GROUP.getChildren();\r\n    for(var i = 0; i < enemyUnits.length; i++) {       \r\n        if(enemyUnits[i].active && Phaser.Math.Distance.Between(x, y, enemyUnits[i].x, enemyUnits[i].y) < distance)\r\n            return enemyUnits[i];\r\n    }\r\n    return false;\r\n} \r\n\r\nfunction damageEnemy(enemy, attack) {  \r\n    // only if both enemy and attack are alive\r\n    if (enemy.active === true && attack.active === true) {\r\n        // we remove the attack right away\r\n        attack.setActive(false);\r\n        attack.setVisible(false);    \r\n        \r\n        // decrease the enemy hp with ATTACK_DAMAGE\r\n        enemy.receiveDamage(ATTACK_DAMAGE);\r\n        //damage.play();\r\n    }\r\n}\r\n\r\nfunction drawLines(graphics) {\r\n    graphics.lineStyle(1, 0x0000ff, 0.8);\r\n    for(var i = 0; i < 8; i++) {\r\n        graphics.moveTo(0, i * 64);\r\n        graphics.lineTo(640, i * 64);\r\n    }\r\n    for(var j = 0; j < 10; j++) {\r\n        graphics.moveTo(j * 64, 0);\r\n        graphics.lineTo(j * 64, 512);\r\n    }\r\n    graphics.strokePath();\r\n}\t\r\n\r\nfunction addAttack(x, y, angle) {\r\n    var attack = ATTACKS_GROUP.get();\r\n    if (attack)\r\n    {\r\n        attack.fire(x, y, angle);\r\n    }\r\n}\r\n//---------------------------------------------------------CLASSES--------------------------------------------\r\n//enemy class\r\nclass Enemy extends Phaser.GameObjects.Sprite {\r\n\r\n    constructor (scene)\r\n    {\r\n        super(scene);\r\n        //dknight.animations.add('walk_down', 1, 4);\r\n        //this.anims.create({ key: 'down', frames: this.anims.generateFrameNames('deathknight', { prefix: 'walk_down_', start: 1, end: 4 }), frameRate: 5, repeat: -1 })\r\n\t\t//var enemy = Phaser.GameObjects.Sprite.call(this, scene, 0, 0, 'deathknight');\r\n\r\n        this.follower = { t: 0, vec: new Phaser.Math.Vector2() };\r\n        this.hp = 0;\r\n        this.turned = 0;\r\n\t\t\r\n\t\t//this.text = scene.add.text(0, 0, \"HP: \"+ ENEMY_HP, {font: \"16px Arial\", fill: \"#ffffff\"});\r\n\t\t//this.text.setPadding(0, 0, 0, 60);\r\n\t\t//this.text.setOrigin(0.5);\r\n\t\tthis.healthbar = new HealthBar(scene, 0, 0);\r\n\t\t\r\n    }\r\n\r\n\tstartOnPath ()\r\n\t{\r\n\t\tthis.follower.t = 0;\r\n\t\tthis.hp = ENEMY_HP;\r\n\t\t\r\n\t\t//this.walk.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\r\n\t\tpath.getPoint(this.follower.t, this.follower.vec);\r\n\t\t\r\n\t\tthis.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\t\r\n\t\t//this.text.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\tthis.healthbar.setPosition(this.follower.vec.x - this.width, this.follower.vec.y - this.height);\r\n\t }\r\n\t\r\n\treceiveDamage(damage) {\r\n\t\tthis.hp -= damage;           \r\n\t\t//this.text.setText(\"HP: \" + this.hp);\r\n\t\tthis.healthbar.decrease(damage);\r\n\t\tthis.damage.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\r\n\t\t// if hp drops below 0 we deactivate this enemy\r\n\t\tif (this.hp <= 0) {\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\t//this.text.setActive(false);\r\n\t\t\t//this.text.setVisible(false);\r\n\t\t\tthis.healthbar.destroy();\r\n\t\t\t\r\n\t\t\t//Need to set this to stop when all enemies are dead\r\n\t\t\tthis.death.play();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\t//this.walk.stop();\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdate (time, delta)\r\n\t{\r\n\t\t//ENEMY_SPEED = 1/Math.floor((Math.random() * (10000 - 5000)) + 5000);\r\n\t\tthis.follower.t += ENEMY_SPEED * delta;\r\n\t\t\r\n\t\tpath.getPoint(this.follower.t, this.follower.vec);\r\n\t\t\r\n\t\tthis.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\t//this.text.setPosition(this.follower.vec.x, this.follower.vec.y);\r\n\t\tthis.healthbar.setPosition(this.follower.vec.x - this.width, this.follower.vec.y - this.height);\r\n\t\t\r\n\t\tif (this.follower.vec.y == 164 && this.turned == 0) {\r\n\t\t\tthis.anims.play('dkright');\r\n\t\t\tthis.turned = 1;\r\n\t\t}\r\n\t\telse if (this.follower.vec.y != 164 && this.turned == 1)\r\n\t\t{\r\n\t\t\tthis.anims.play('dkdown');\r\n\t\t\tthis.turned = 2;\r\n\t\t}\r\n\r\n\t\tif (this.follower.t >= 1)\r\n\t\t{\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\t//this.text.setActive(false);\r\n\t\t\t//this.text.setVisible(false);\r\n\t\t\tthis.healthbar.destroy();\r\n\t\t\t//this.walk.stop();\t\t\t\t\t\t\t\t\t\t\t\t//sounds\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n};\r\n\r\nclass Deathknight extends Enemy {\r\n\tconstructor(scene) {\r\n\t\tsuper(scene);\r\n\t\tPhaser.GameObjects.Sprite.call(this, scene, 0, 0, 'deathknight');\r\n\t\t\r\n\t\t//create animations\r\n\t\tscene.anims.create({\r\n\t\t\tkey: 'dkdown',\r\n\t\t\tframes: scene.anims.generateFrameNames('deathknight', { prefix: 'walk_down_', start: 1, end: 4 }),\r\n\t\t\tframeRate: 3,\r\n\t\t\trepeat: -1\r\n\t\t});\r\n\t\tscene.anims.create({\r\n\t\t\tkey: 'dkright',\r\n\t\t\tframes: scene.anims.generateFrameNames('deathknight', { prefix: 'walk_right_', start: 1, end: 4 }),\r\n\t\t\tframeRate: 5,\r\n\t\t\trepeat: -1\r\n\t\t});\r\n        this.anims.play('dkdown');\r\n\t\t\r\n\t\t//create sounds\r\n\t\tthis.death = scene.sound.add('dkDeath');\r\n\t\tthis.death.volume = 0.05;\r\n\t\tthis.death.loop = false;\r\n\t\t\r\n\t\tthis.damage = scene.sound.add('hit');\r\n\t\tthis.damage.volume = 0.03;\r\n\t\tthis.damage.loop = false;\r\n\t\t\r\n\t\t/* this.walk = scene.sound.add('walk');\r\n\t\tthis.walk.volume = 0.01;\r\n\t\tthis.walk.loop = true; */\r\n\t}\r\n\tpFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\n//tower class\r\nclass Tower extends Phaser.GameObjects.Sprite{\r\n\r\n\tconstructor (scene, stats)\r\n\t{\r\n\t\tsuper(scene);\r\n\r\n\t\tthis.nextTic = 0;\r\n\t\tthis.towerId =  stats.towerId; //each tower has unique id\r\n\t\tthis.towerName = stats.towerName;\r\n\t\tthis.upgrade = stats.upgrade; //true = can upgrade, false = can't upgrade\r\n\t\tthis.str = stats.str; //value tha determines attack strength\r\n\t\tthis.atkRange = stats.atkRange;\r\n\t\tthis.atkType = stats.atkType;\r\n\t\tthis.atkRate = stats.atkRate; \r\n\t\tthis.hitFly = stats.hitFly; //true = can hit flying enemeies, false = cannot hit flying enemies\r\n\t\t//this.aoeRange = aoeRange; //area of effect range\r\n\t\t//this.spc = spc; //has special attack, each value represents special type, 0 = none, 1 = chance to stun, etc.\r\n\t\t\r\n\t\tthis.text = scene.add.text(0, 0, this.towerName, {font: \"16px Arial\", fill: \"#ffffff\"});\r\n\t\t\r\n\t\tthis.upgradeSound = scene.sound.add('upgradeSound');\r\n\t\tthis.upgradeSound.volume = 0.05;\r\n\t\tthis.upgradeSound.loop = false;\r\n\t\t\r\n\t}\r\n\t\r\n\tplaceTower(pointer,scene) {\r\n\t\tvar i = Math.floor(pointer.y/64);\r\n\t\tvar j = Math.floor(pointer.x/64);\r\n\t\tif(map[i][j] === 0) {\r\n\t\t\t//console.log(tower);\r\n\t\t\tif (this)\r\n\t\t\t{\r\n\t\t\t\tthis.text.y = (i+.50) * 64 + 64/2;\r\n\t\t\t\tthis.text.x = j * 64 + 64/2;\r\n\t\t\t\tthis.text.setOrigin(0.5);\r\n\t\t\t\t//scene.add.container([this.text, this]);\r\n\t\t\t\tthis.setActive(true);\r\n\t\t\t\tthis.setVisible(true);\r\n\t\t\t\tthis.y = i * 64 + 64/2;\r\n\t\t\t\tthis.x = j * 64 + 64/2;\r\n\t\t\t\t//map[i][j] = 1;\r\n\t\t\t\tmap[i][j] = this;\r\n\t\t\t}   \r\n\t\t\t//console.log(TOWER_GROUP.getTotalUsed());\r\n\t\t\t//console.log(TOWER_GROUP.getLength());\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tTOWER_GROUP[this.towerId].remove(this, true, true);\t\t//tower is created before it's placed so removed if the place clicked on is  not avaialble\r\n\t\t}\r\n\t}\r\n\r\n\tremoveTower(pointer) {\r\n\t\tvar i = Math.floor(pointer.y/64);\r\n\t\tvar j = Math.floor(pointer.x/64);\r\n\t\tif(map[i][j] !== 0) {\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n\t\t\tthis.text.destroy();\r\n\t\t\tmap[i][j] = 0;\t\t\t\t\t\t\t\t\t\t\t\t//remove from map\r\n\t\t\tTOWER_GROUP[this.towerId].remove(this, true, true);\t\t\t//removes from group, if want to keep it as inactive then remove this line\r\n\t\t}\r\n\t\t\t\r\n\t}\r\n\t\r\n\tupgradeTower(pointer, newTower, scene) {\r\n\t\t//check if tower is already upgraded, if not the upgrade\r\n\t\tif(this.towerName !== newTower.towerName)\r\n\t\t{\r\n\t\t\tvar i = Math.floor(pointer.y/64);\r\n\t\t\tvar j = Math.floor(pointer.x/64);\r\n\t\t\tthis.removeTower(pointer);\r\n\t\t\tnewTower.placeTower(pointer, scene);\r\n\t\t\t//console.log(TOWER_GROUP.getTotalUsed());\r\n\t\t\t//console.log(TOWER_GROUP.getLength());\r\n\t\t\tthis.text = newTower.towerName;\r\n\t\t\tthis.upgradeSound.play();\r\n\r\n            /* scene.tweens.add({\r\n                targets: newTower, // on the player \r\n                duration: 200, // for 200ms \r\n                scaleX: 1.2, // that scale vertically by 20% \r\n                scaleY: 1.2, // and scale horizontally by 20% \r\n                alpha: 0.2,\r\n                yoyo: true, // at the end, go back to original scale \r\n            }); */\r\n\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tTOWER_GROUP[newTower.towerId].remove(newTower, true, true);\t\t//tower is created before it's placed so removed if the place clicked on is  not avaialble\r\n\t\t\tnewTower.text.destroy();\r\n\t\t}\r\n\t\r\n\t}\r\n\t\r\n\tfire() {\r\n\t\tvar enemy = getEnemy(this.x, this.y, 200);\r\n\t\tif(enemy) {\r\n\t\t\tvar angle = Phaser.Math.Angle.Between(this.x, this.y, enemy.x, enemy.y);\r\n\t\t\taddAttack(this.x, this.y, angle);\r\n\t\t\t//this.angle = (angle + Math.PI/2) * Phaser.Math.RAD_TO_DEG;    //uncomment to make towers rotate to face enemy\r\n\t\t}\r\n\t}\r\n\t\r\n\tupdate(time, delta, pointer)\r\n\t{\r\n\t\tif(time > this.nextTic) {\r\n\t\t\tthis.fire();\r\n\t\t\tthis.nextTic = time + TOWER_FIRE_RATE;\r\n\t\t}\r\n\t}\r\n\tsayName()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n};\r\n\r\nclass Peasant extends Tower {\r\n\tconstructor(scene, stats) {\r\n\t\t// Note: In derived classes, super() must be called before you\r\n\t\t// can use 'this'. Leaving this out will cause a reference error.\r\n\t\tsuper(scene, stats);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'peasant', 'sprite35');\r\n\t}\r\n\tpFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\nclass Soldier extends Tower {\r\n\tconstructor(scene, stats) {\r\n\t\tsuper(scene, stats);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'soldier', 'sprite25');\r\n\r\n\t}\r\n\tsFn()\r\n\t{\r\n\t\tconsole.log(this.towerName);\r\n\t}\r\n\r\n}\r\n\r\n//all other classes\r\n//HP class\r\nclass HealthBar {\r\n\r\n    constructor(scene, x, y) {\r\n        this.bar = new Phaser.GameObjects.Graphics(scene);\r\n\r\n        this.x = x;\r\n        this.y = y;\r\n        this.value = ENEMY_HP;\r\n        this.p = .076;\r\n\r\n        this.draw();\r\n\r\n        scene.add.existing(this.bar);\r\n    }\r\n\r\n    setPosition(x, y) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.draw();\r\n    }\r\n\r\n    decrease(amount) {\r\n        this.value -= amount;\r\n\r\n        if (this.value < 0) {\r\n            this.value = 0;\r\n        }\r\n\r\n        this.draw();\r\n\r\n        return (this.value === 0);\r\n    }\r\n\r\n    draw() {\r\n        this.bar.clear();\r\n\r\n        //  BG\r\n        this.bar.fillStyle(0x000000);\r\n        this.bar.fillRect(this.x, this.y, 80, 16);\r\n\r\n        //  Health\r\n\r\n        this.bar.fillStyle(0xffffff);\r\n        this.bar.fillRect(this.x + 2, this.y + 2, 76, 12);\r\n\r\n        if (this.value < 0.6 * ENEMY_HP) {\r\n            this.bar.fillStyle(0xff0000);\r\n        }\r\n        else if (this.value < 0.3 * ENEMY_HP)\r\n            this.bar.fillStyle(0x00ffff);\r\n        else {\r\n            this.bar.fillStyle(0x00ff00);\r\n        }\r\n\r\n        var d = Math.floor(this.p * this.value);\r\n\r\n        this.bar.fillRect(this.x + 2, this.y + 2, d, 12);\r\n    }\r\n\r\n    destroy() {\r\n        this.bar.destroy();\r\n    }\r\n\r\n}\r\n\r\n//the yellow thing the towers shoots at enemy, can be any form of projectile\r\nclass Attack extends Phaser.GameObjects.Image {\r\n\tconstructor(scene)\r\n\t{\r\n\t\tsuper(scene);\r\n\t\tPhaser.GameObjects.Image.call(this, scene, 0, 0, 'attack');\r\n\r\n\t\tthis.incX = 0;\r\n\t\tthis.incY = 0;\r\n\t\tthis.lifespan = 0;\r\n\r\n\t\tthis.speed = Phaser.Math.GetSpeed(600, 1);\r\n\r\n    \tthis.particles = scene.add.particles('attack');\r\n\r\n        this.emitter = this.particles.createEmitter({\r\n            speed: 75,\r\n            scale: { start: 0.2, end: 0 },\r\n            quantity: 1,\r\n            blendMode: 'SCREEN'\r\n        });\r\n\r\n\t    this.emitter.startFollow(this);\r\n        \r\n\t}\r\n\r\n\tfire(x, y, angle)\r\n\t{\r\n\t\tthis.setActive(true);\r\n\t\tthis.setVisible(true);\r\n\t\t//  Attacks fire from the middle of the screen to the given x/y\r\n\t\tthis.setPosition(x, y);\r\n\t\t\r\n\t//  we don't need to rotate the attacks as they are round\r\n\t//    this.setRotation(angle);\r\n\r\n\t\tthis.dx = Math.cos(angle);\r\n\t\tthis.dy = Math.sin(angle);\r\n\r\n\t\tthis.lifespan = 1000;\r\n\t}\r\n\r\n\tupdate (time, delta)\r\n\t{\r\n\t\tthis.lifespan -= delta;\r\n\t\tthis.x += this.dx * (this.speed * delta);\r\n\t\tthis.y += this.dy * (this.speed * delta);\r\n        this.emitter.explode(5,this.x,this.y);\r\n\r\n\t\tif (this.lifespan <= 0)\r\n\t\t{\r\n\t\t\tthis.setActive(false);\r\n\t\t\tthis.setVisible(false);\r\n            \r\n\t\t}\r\n\t}\r\n\r\n};\r\n\r\n//----------------------------------------------------GAME-------------------------------------------\t\r\n\t\r\n//Preload function loads assets before game starts\r\nfunction preload() {    \r\n\t//load tower sprites, set to 2 since we only have 2 developed classes at the moment\r\n\tfor(var i = 0; i < 2; i++) {\r\n\t\tlet name = towerArr[i].towerName.toLowerCase();\r\n\t\tthis.load.atlas(name, 'assets/'+name+'.png', 'assets/'+name+'.json');\r\n\t}\r\n\t//load enemy sprites, will be a loop like load tower sprites\r\n    this.load.atlas('deathknight', 'assets/deathknight.png', 'assets/deathknight.json');\r\n\t\r\n\t//load map\r\n\tthis.load.image('map', 'assets/castle-gates.png', { frameWidth: 640, frameHeight: 512 });\r\n\t\r\n\t//load sounds\r\n\tthis.load.audio('dkDeath', 'assets/Sounds/Death Screams/Human/sfx_deathscream_human5.wav');\r\n\tthis.load.audio('hit', 'assets/Sounds/General Sounds/Simple Damage Sounds/sfx_damage_hit2.wav');\r\n\tthis.load.audio('walk', 'assets/Sounds/Movement/Footsteps/sfx_movement_footstepsloop4_slow.wav');\r\n\tthis.load.audio('background', 'assets/Sounds/random silly chip song.ogg');\r\n\tthis.load.audio('upgradeSound', 'assets/Sounds/General Sounds/Positive Sounds/sfx_sounds_powerup6.wav');\r\n\t\r\n\t//load misc\r\n\tthis.load.image('attack', 'assets/coin.png');\r\n\r\n}\r\n \r\n//create function initializes and adds assets to game\r\nfunction create() {\r\n\t/*creates a group for a tower type, that way we can use TOWER_GROUP.get(towerStats) to instantiate new towers easily\r\n\tloop through towerArr to get each tower object\r\n\tthen add each object to TOWER_GROUP arr\r\n\twe do this becuase TOWER_GROUP can now be easily used to manipulate tower objects with Phaser functions.*/\r\n\t//loop set to 2 since we only have 2 developed classes at the moment\r\n\tfor(var i = 0; i < 2; i++) {\r\n\t\tTOWER_GROUP[towerArr[i].towerId] = this.add.group({ classType: eval(towerArr[i].towerName), runChildUpdate: true });\r\n\t}\r\n\t\r\n\t//enemy group will be a loop similar to tower group\r\n\tENEMY_GROUP = this.physics.add.group({ classType: Deathknight, runChildUpdate: true }); //key: 'walk_down_', frame: [1, 2, 3, 4], repeat: 5, active: true });\r\n\t\r\n\t//turned into attack group soon for different attack types\r\n\tATTACKS_GROUP = this.physics.add.group({ classType: Attack, runChildUpdate: true });\r\n\t\r\n\t//build the game map, this includes pathing, map image, background sounds, and general game assets\r\n\tbuildMap(this);\r\n\t\r\n\t//input related actions in userAction function\r\n\tthis.input.on('pointerdown', function (pointer){userAction(pointer, this)});\r\n\r\n\t/*let nextScene = this.add.text(this.game.renderer.width / 2, this.game.renderer.height / 2, 'nextScene').setDepth(1);\r\n\tnextScene.setInteractive();\r\n\tnextScene.on(\"pointerdown\", ()=>{\r\n\t\tthis.scene.start(CST.SCENES.GAME2, \"Armory Level\");\r\n\t})*/\r\n}\r\n\r\n//update function constantly refreshes so to progress game\r\nfunction update(time, delta) {  \r\n\r\n\tif (time > this.nextEnemy)\r\n\t{\r\n\t\tvar enemy = ENEMY_GROUP.get(path);\r\n\t\tif (enemy)\r\n\t\t{\r\n\t\t\tenemy.setActive(true);\r\n\t\t\tenemy.setVisible(true);\r\n\t\t\tenemy.startOnPath();\r\n\t\t\t//ENEMY_SPEED = 1/Math.floor((Math.random() * (2000 - 500)) + 500);\r\n\t\t\tthis.nextEnemy = time + ENEMY_SPAWN_RATE;\r\n\t\t}       \r\n\t}\r\n\t\r\n}\r\n\r\n"]}